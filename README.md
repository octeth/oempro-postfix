# Octeth Postfix Add-On

This add-on adds a Postfix container to the server so that Octeth can send emails through this Postfix add-on.

## Installation Instructions

Build the Docker container:

```bash
docker build -t octeth-postfix .
```

Run the container:

```bash
# If this container is going to be running on Octeth's server, run this command:
docker run -d --name octeth-postfix --network oempro-network --dns 1.1.1.1 --dns 8.8.8.8 --dns 8.8.4.4 -p 2526:25 -v $(pwd)/dkim-keys:/etc/opendkim/keys octeth-postfix
```

## Setting Up DKIM

### Generating DKIM Keys

Generate DKIM keys:

```sh
docker exec -ti octeth-postfix bash -c "opendkim-genkey -b 2048 -s key1 -D /etc/opendkim/keys/ -v"
```

or use [Octeth DKIM Generator](https://www2.octeth.com/dkim-generator/).

### DNS Configuration

For each domain, add the content of the `*.txt` file generated by `opendkim-genkey` as a TXT record in your DNS settings. For example, for `test.com`:

- Record Name: `key1._domainkey.test.com`
- Record Type: `TXT`
- Record Value: `v=DKIM1; k=rsa; p=...` (the full content of `yourdomain.com.txt`)

### Configuring OpenDKIM

1. **Update the `signing.table` to include all your domains:**

   ```sh
   *@test.com default._domainkey.test.com
   *@test2.com default._domainkey.test2.com
   ```

2. **Update the `trusted.hosts` to include all your domains:**

   ```sh
   127.0.0.1
   localhost
   yourdomain.com
   anotherdomain.com
   ```

3. **Update `KeyTable` to map domains to their keys:**

   Create a file named `key.table` with the following content:

   ```sh
   key1._domainkey.test.com test.com:default:/etc/opendkim/keys/key1.private
   key1._domainkey.test2.com test2.com:default:/etc/opendkim/keys/key1.private
   ```

4. **Update `opendkim.conf` to include the KeyTable:**

   ```conf
   # Basic OpenDKIM configuration
   Syslog          yes
   LogWhy          yes

   Canonicalization        relaxed/simple
   Selector                default
   Domain                  yourdomain.com
   KeyTable                refile:/etc/opendkim/key.table
   SigningTable            refile:/etc/opendkim/signing.table
   ExternalIgnoreList      refile:/etc/opendkim/trusted.hosts
   InternalHosts           refile:/etc/opendkim/trusted.hosts

   Socket                  inet:12301@localhost
   ```
### Verifying the Setup

1. **Check Postfix logs for DKIM signing:**

   ```sh
   docker exec -it postfix-dkim tail -f /var/log/mail.log
   ```

2. **Send a test email and check the headers to ensure DKIM signing is applied:**

   Look for the `DKIM-Signature` header in the received email.

By following these steps, you can set up DKIM for multiple sender domains with Postfix and OpenDKIM.

## Setting Up As Octeth Delivery Server

In Octeth's delivery server settings;

- Name: octeth-postfix
- Host: octeth-postfix
- Port: 25
- Security: No secured connection
- Connectin Time Out: 10
- Authentication: Authentication not required
- Link Tracking: {octeth_domain}
- Open Tracking: {octeth_domain}
- MFROM domain: {octeth_domain}

